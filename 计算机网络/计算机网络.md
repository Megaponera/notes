# 数据链路层

## 基本概念

### 功能

实现 **点到点** 数据传输。数据链路层将数据封装成 **帧** ，将其从一台主机中，经过路由器、交换机等设备，发送到另一台主机中。其中，主机、交换机、路由器等设备被称为 **节点** ；节点通过 **光纤、电缆** 等物理设备进行连接，形成的路径称为 **链路**



数据链路层在物理层提供服务的基础上 **向网络层提供服务**，最基本的服务是将源自网络层来的数据 **可靠** 地运输到相邻节点的目标主机的网络层。其主要作用是 **加强物理层传输原始比特流的功能**，将物理层提供的可能出错的物理连接改造成为 **逻辑上无差错的数据链路**，使之对网络层表现位一条无差错的链路



## 封装成帧和透明传输

数据链路层从网络层获取数据源后，会将其封装成 **帧** ，帧由帧首部、数据源、帧尾部组成



### 透明传输

透明传输是指不管所传数据是什么样的比特组合，都应该能够在链路上传送

当所传数据中的比特组合恰巧与某一个控制信息完全一样时，就必须采取适当的措施，使接收方不会将这样的数据误认为是某种控制信息



### 封帧方法

- 字符记数法

帧首部使用一个计数字段（第一个字节，八位）来表明帧内字符数



- 字符填充法

使用控制字符作为帧的首部和尾部。若数据源中出现控制信息比特组合，则在其前面增加一个转义字符



- 零比特填充法

使用 01111110 作为帧首部和尾部。如果数据源中连续出现5个1，则在第5个1后面加一个0，以此区分帧首部和尾部



- 违规编码法

使用曼彻斯特编码，即 0-1 或者 1-0 这种比特组合对数据源进行修改，帧首部和尾部使用 0-0 或者 1-1



## 差错控制

#### 奇偶校验法

在校验码前面添加1或者0，使得校验码中1的个数为奇/偶数

例：奇校验码  1010011   则为   11010011

**缺点：只能检测奇数位错误**

例如：上面的校验码，可以检测 100100101 发生了错误，因为该比特组合有偶数位1；而无法检测100100100 因为其有奇数位1，无法确定是否发生了错误



#### CRC循环冗余检测法

例如：要传的数据为  1101 0110 11     **生成多项式**为 10011

则 **帧检验序列（FCS）**为  1101 0110 11 除于 10011 的余数

二进制除法：

除数 10011 的阶为 N - 1 = 4

将被除数左移4位，得到 1101 0110 11 0000

用除数 10011 对被除数按位异或获得其余数为 110，将余数与被除数进行与操作得到 1101 0110 11 0110 最终得到**CRC循环冗余检验码**

用该检验码对数据进行异或操作，若结果为0，则一般认为无错误；否则数据有问题



#### 海明码检测法

$$
2^r >= k+r+1(k代表数据的位数,r根据k而调整)
$$



1. 确定校验码的位数 (r + k)

2. 确定校验码的位置 
   $$
   2^0, 2^1, 2^2, ...
   $$

3. 确定校验码的值：与校验码位置进行与操作后，结果不为0的位置的值，令其异或，使结果为0

4. 检错与纠错：与步骤3操作方法一致，若结果不为零，则证明出现错误（**发现双比特错，纠正单比特错**）
   根据检错过程中获得的值，将其从高位到低位进行拼接，得到的二进制数的值，代表发生错误的位置



